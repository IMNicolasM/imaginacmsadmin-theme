"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[1796],{48336:(t,e,a)=>{a.r(e),a.d(e,{default:()=>b});var i=a(92444);function s(t,e,a,s,r,o){const l=(0,i.E1)("form-orders"),n=(0,i.E1)("commentsModal"),d=(0,i.E1)("crud"),u=(0,i.E1)("inner-loading");return(0,i.Wz)(),(0,i.An)("div",{id:"crudPage",key:r.pageId},[r.crudLoading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(l,{key:0,ref:"formOrders",onRefreshData:e[0]||(e[0]=t=>o.getDataTable(!0))},null,512)),r.crudLoading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(n,{key:1,ref:"commentsModal",commentableId:r.commentableId,isCrud:""},null,8,["commentableId"])),r.crudLoading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(d,{key:2,"crud-data":r.crudCustom,"custom-data":o.crudData,ref:"crudComponent",title:t.$route.meta.title},null,8,["crud-data","custom-data","title"])),(0,i.K2)(u,{visible:r.loadingBulk},null,8,["visible"])])}var r=a(86284),o=a(30152),l=a(12320),n=a(26276);const d=t=>{const e=`\n    <div \n      class="\n        tw-relative \n        tw-inline-flex \n        tw-items-center\n        tw-font-medium \n        tw-text-center \n        tw-rounded-lg \n        hover:bg-blue-800 \n        focus:ring-4 \n        focus:outline-none \n        focus:ring-blue-300 \n        dark:bg-blue-600 \n        dark:hover:bg-blue-700 \n        dark:focus:ring-blue-800\n        tw-text-xl\n        tw-cursor-pointer"\n      >\n      <i\n        class="\n          fa-light \n          fa-comment-lines \n          tw-pr-1 \n          tw-text-red-500 \n          tw-font-semibold" \n      ></i>\n      <div\n        class="\n        tw-absolute \n        tw-inline-flex \n        tw-items-center tw-justify-center \n        tw-w-4 \n        tw-h-4\n        tw-font-bold \n        tw-text-white\n        tw-border \n        tw-bg-red-500 \n        tw-rounded-full \n        tw--top-1 \n        tw--right-2 dark:border-gray-900"\n        style="font-size: 7px;"\n      >${t}</div>\n</div>\n`;return e.toString()},u=d;var m=a(36852),c=a(8932);const p={props:{},components:{formOrders:l.c,commentsModal:n.c},watch:{$route:{deep:!0,handler:function(){this.init()}},"$filter.values":{deep:!0,handler:function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&(this.areaId=this.$filter.values.areaId)}}},validations(){return{}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{pageId:this.$uid(),commentableId:null,crudId:this.$uid(),areaId:null,loadingBulk:!1,crudCustom:"",crudLoading:!0}},beforeUnmount(){(0,o.c)().setFlightList([]),(0,o.c)().setFlightId(null)},computed:{isAppOffline(){return this.$store.state.qofflineMaster.isAppOffline},permisionCommentsIndex(){return this.$hasAccess("ramp.work-orders-comments.index")},filter(){return this.$filter},editPermissionseSubmitted(){return(0,o.c)().editPermissionseSubmitted()},validateStatus(){return t=>t==r._G||t==r.g1||t==r.lC||t==r.kz||t==r._y&&this.editPermissionseSubmitted},crudData(){return{apiRoute:"apiRoutes.qramp.workOrders",create:{method:async()=>{await(0,o.c)().setTitleOffline(this.$tr("ifly.cms.form.newWorkOrder")),await(0,o.c)().setIsPassenger(!this.isRamp),this.$refs.formOrders.loadform({modalProps:{title:this.$tr("ifly.cms.form.newWorkOrder"),update:!1,width:"35vw"}})}},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"width: 50px",action:t=>!1},{name:"customer",label:this.$tr("isite.cms.label.customer"),field:t=>t.customCustomerName||t.customer,formatAsync:async t=>{if(t.customCustomerName)return t.customCustomerName;const e=await(0,m["default"])().getCustomerList().find((e=>e.id===t.customerId))||{};return`${e.customerName||"-"}`},align:"left"},{name:"comments",label:"Comments",field:"comments",align:"left",tooltip:!1,format:t=>!this.$store.state.qofflineMaster.isAppOffline&&t&&t>0?u(t):"",formatColumn:t=>({textColor:t.comments?"red-5":""}),action:t=>{this.commentableId=t.id||null,this.$refs.commentsModal&&this.$refs.commentsModal.showModal()}},{name:"flightStatus",label:"Flight Status",field:"flightStatus",align:"left",formatColumn:t=>{const e=(0,m["default"])().getFlightStatusesList().find((e=>e.id===t.flightStatusId))||{};return{bgTextColor:e&&e.color?`tw-bg-${e.color}`:""}},formatAsync:async t=>{const e=await(0,m["default"])().getFlightStatusesList().find((e=>e.id===t.flightStatusId))||{};return`${e.name||"-"}`}},{name:"inboundFlightNumber",label:"Inbound Flight Number",field:t=>`${t.inboundFlightNumber?t.inboundFlightNumber:""}${t.faFlightId?"":"(Manually)"}`,align:"left",format:t=>t?`<span class="tw-border tw-p-1 tw-rounded-md tw-font-medium"/>${t}</span>`:"",action:t=>{const e=t.faFlightId?t.faFlightId.split("-")[0]:null,a={workOrderId:t.id,faFlightId:t.faFlightId,flightNumber:e||t.inboundFlightNumber,boundScheduleDate:t.inboundScheduleArrival||this.$moment().format("YYYY-MM-DDTHH:mm:ss"),type:"inbound"};this.getFlightMap(a)}},{name:"inboundScheduledArrival",label:"Arrival",field:"inboundScheduledArrival",align:"left",format:t=>t?this.$trdT(t):"-",sortable:!0},{name:"outboundFlightNumber",label:"Outbound Flight Number",field:t=>`${t.outboundFlightNumber?t.outboundFlightNumber:""}${t.faFlightId?"":"(Manually)"}`,align:"left",format:t=>t?`<span class="tw-border tw-p-1 tw-rounded-md tw-font-medium"/>${t}</span>`:"",action:t=>{const e=t.outboundFaFlightId?t.outboundFaFlightId.split("-")[0]:null,a={workOrderId:t.id,faFlightId:t.outboundFaFlightId,flightNumber:e||t.outboundFlightNumber,boundScheduleDate:t.outboundScheduledDeparture||this.$moment().format("YYYY-MM-DDTHH:mm:ss"),type:"outbound"};this.getFlightMap(a)}},{name:"outboundScheduledDeparture",label:"Departure",field:"outboundScheduledDeparture",align:"left",format:t=>t?this.$trdT(t):"-",sortable:!0},{name:"adHoc",label:"Ad Hoc",field:"adHoc",format:t=>t?"Yes":"No",align:"left"},{name:"statusName",label:this.$tr("isite.cms.form.status"),field:"workOrderStatus",formatAsync:async t=>{const e=await(0,m["default"])().getWorkOrderStatusesList().find((e=>e.id===t.statusId))||{},a=e?e.statusName+(t.needToBePosted?"(Posting)":""):"-";return`${a}`},align:"left"},{name:"operationType",label:"Operation Type",field:"operationTypeId",formatAsync:async t=>{const e=await(0,m["default"])().getOperationTypeList().find((e=>e.id===t.operationTypeId))||{};return`${e.operationName||"-"}`},align:"left"},{name:"station",label:"Station",field:"stationId",formatAsync:async t=>{if(!t.stationId)return"-";const e=await(0,m["default"])().getStationList().find((e=>e.id===t.stationId))||{};return`${e.fullName||"-"}`},align:"left"},{name:"responsible",label:"Responsible",field:"responsible",format:t=>t?t.fullName:"-",align:"left"},{name:"created_at",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",align:"left",format:t=>t?this.$trd(t):"-"},{name:"updated_at",label:this.$tr("isite.cms.form.updatedAt"),field:"updatedAt",align:"left",format:t=>t?this.$trd(t):"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],filters:{date:{value:null,type:"dateRange",props:{label:this.isRamp?"Block-in/out Date":"Scheduled date",mask:"YYYY-MM-DD",field:this.isRamp?"blockInBlockOut":"schedule_date"}},customerId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.setupCustomers",select:{label:"customerName",id:"id"},requestParams:{filter:{companyId:this.isRamp?r.wz:r.mI}}},props:{label:"Customer",clearable:!0}},statusId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.workOrderStatuses",select:{label:"statusName",id:"id"},requestParams:{filter:{companyId:this.isRamp?r.wz:r.mI}}},props:{label:"Status",clearable:!0}},stationId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qsetupagione.setupStations",select:{label:"fullName",id:"id"},requestParams:{filter:{companyId:this.isRamp?r.wz:r.mI}}},props:{label:"Station",clearable:!0}},adHoc:{value:null,type:"select",quickFilter:!0,props:{label:"Ad Hoc",clearable:!0,options:[{label:this.$tr("isite.cms.label.yes"),value:!0},{label:this.$tr("isite.cms.label.no"),value:!1}]}},flightStatusId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qfly.flightStatuses",select:{label:"name",id:"id"},requestParams:{filter:{companyId:this.isRamp?r.wz:r.mI}}},props:{label:"Flight Status",clearable:!0}},areaId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qsetupagione.areas",select:{label:"name",id:"id"},requestParams:{filter:{companyId:this.isRamp?r.wz:r.mI}}},props:{label:"Areas",clearable:!0},date:{value:null,type:"dateRange",props:{label:this.isRamp?"Block-in/out Date":"Scheduled date",mask:"YYYY-MM-DD",field:this.isRamp?"blockInBlockOut":"schedule_date"}}},businessUnitId:{value:this.isRamp?r.Ih:r.GK}},requestParams:{include:"responsible",filter:{withoutDefaultInclude:!0,businessUnitId:this.isRamp?r.Ih:r.GK}},actions:[{name:"edit",icon:"fal fa-pen",label:this.$tr("isite.cms.label.edit"),format:t=>({label:this.validateStatus(t.statusId)?this.$tr("isite.cms.label.edit"):this.$tr("isite.cms.label.show"),icon:this.validateStatus(t.statusId)?"fal fa-pen":"fal fa-eye"}),action:t=>{this.showWorkOrder(t)}},{name:"close",icon:"fal fa-check",label:this.$tr("isite.cms.label.closeFlight"),format:t=>({vIf:![r.lC,r._y,r.g1].includes(t.statusId)}),action:t=>{this.changeStatus(r.g1,t.id)}},{name:"submit",icon:"fal fa-check-double",label:this.$tr("isite.cms.label.submit"),format:t=>({vIf:this.$hasAccess("ramp.work-orders.submit")&&![r.lC,r._y].includes(t.statusId)}),action:t=>{this.changeStatus(r._y,t.id)}},{name:"post",icon:"fal fa-paper-plane",label:this.$tr("isite.cms.label.post"),action:t=>{this.changeStatus(r.lC,t.id)},format:t=>({vIf:this.$hasAccess("ramp.work-orders.post")&&!t.adHoc&&!t.needToBePosted&&![r.lC].includes(t.statusId),label:this.$tr("isite.cms.label.post")})},{name:"repost",icon:"fas fa-paper-plane",label:"Repost",action:t=>{this.changeStatus(r.lC,t.id)},format:t=>({vIf:this.$hasAccess("ramp.work-orders.re-post")&&!t.adHoc&&t.statusId==r.lC})},{name:"Comments",icon:"fa-light fa-comment",label:"Comments",action:t=>{this.commentableId=t.id||null,this.$refs.commentsModal&&this.$refs.commentsModal.showModal()},format:t=>({vIf:this.permisionCommentsIndex&&!this.isAppOffline})},{name:"Reload Transactions",icon:"fa-solid fa-rotate-right",label:"Reload Transactions",action:t=>{this.postReloadTransactions(t.id)},format:t=>({vIf:this.$hasAccess("ramp.work-orders.reload-transactions")})}],bulkActions:[{apiRoute:"apiRoutes.qramp.bulkPost",permission:"ramp.work-orders.bulk-post",criteria:"id",props:{icon:"fas fa-paper-plane",label:"Post"}},{apiRoute:"apiRoutes.qramp.bulkSubmit",permission:"ramp.work-orders.bulk-submit",criteria:"id",props:{icon:"fas fa-check",label:"Submit"}},{apiRoute:"apiRoutes.qramp.bulkExportPdf",permission:"ramp.work-orders.bulk-export-pdf",criteria:"id",props:{icon:"fa-solid fa-print",label:"Print Bulk(PDF)"}},{apiRoute:"apiRoutes.qramp."+(this.isRamp?"bulkExportCsv":"passengerBulkExportCsv"),permission:"ramp.work-orders.bulk-export-csv",criteria:"id",props:{icon:"fas fa-download",label:"Bulk(CSV)"}},{apiRoute:"apiRoutes.qramp.bulkReloadTransactions",permission:"ramp.work-orders.bulk-reload-transactions",criteria:"id",props:{icon:"fa-solid fa-rotate-right",label:"Reload Transactions"}}],relation:{permission:"ramp.work-orders.see-workday-transactions",apiRoute:"apiRoutes.qramp.workOrderTransactions",requestParams:t=>({filter:{workOrderId:t.id},include:"product,contractLine"}),columns:[{name:"productId",label:"Sale Item Id",field:"product",format:t=>t?.externalId||"-"},{name:"productName",label:"Sale Item Name",field:"product",format:t=>t?.name||"-"},{name:"contractLineWorkdayId",label:"Contract LI Id",field:"contractLine",format:t=>t?.contractLineWorkdayId||"-"},{name:"invoiceLineMemo",label:"Invoice Line Memo",field:"contractLine",format:t=>t?.invoiceLineMemo||"-"},{name:"quantity",label:"Quantity",field:"quantity"},{name:"rate",label:"Rate",field:"contractLine",format:t=>t?.rate||"-"},{label:"Total",field:t=>{const e=t.quantity||0,a=t.contractLine?.rate||0;return e*a}},{name:"transactionId",label:"Transaction Id",field:"transactionId"},{name:"postedAt",label:"Date Posted",field:"postedAt",format:t=>t?this.$trdT(t):"-"},{name:"amount",label:"ammount",field:"ammount"}]}},update:!1,delete:!0,formLeft:{}}},getCustomerName(){return t=>{let e=t;return t&&(e="object"===typeof t?t.customerName:t),e||"-"}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}},isRamp(){return this.$route.path.includes("ramp")}},methods:{async postReloadTransactions(t){try{this.loadingBulk=!0,await this.$crud.update("apiRoutes.qramp.reloadTransactions",t,{}),await this.$root.$emit("crud.data.refresh"),this.loadingBulk=!1}catch(e){this.loadingBulk=!1}},init(){this.crudLoading=!0,this.crudCustom=this.isRamp?Promise.all([a.e(1968),a.e(1640),a.e(7356)]).then(a.bind(a,5332)):Promise.all([a.e(1968),a.e(1640),a.e(8076)]).then(a.bind(a,66606)),this.pageId=this.$uid(),this.handlerUrlCrudAction(),this.crudLoading=!1},handlerUrlCrudAction(){setTimeout((()=>{let t=this.$route.query;t.edit&&this.$refs.crudComponent.update({id:t.edit}),t.create&&this.$refs.crudComponent.create()}),500)},async getDataTable(t){await this.$refs.crudComponent.getDataTable(t)},getOfflineTitleStatus(t,e){const a={1:"DRAFT",2:"POSTED",3:"SUBMITTED",4:"CLOSED",5:"SCHEDULE"};return`Work Order ${a[t]} - ID ${e}`},async changeStatus(t,e){const a="apiRoutes.qramp.workOrderChangeStatus",i="apiRoutes.qramp.workOrders",s={id:e,statusId:t};let r={params:{titleOffline:this.getOfflineTitleStatus(t,e)||""}};this.$emit("loading",!0),s.offline=!0,await c.a4.updateRecord(i,s,s?.id),await this.getDataTable(!0);const o=this.$crud.update(a,e,s,r);o.then((async t=>{await this.getDataTable(!0),this.$emit("loading",!1)})).catch((async t=>{this.$emit("loading",!1),this.isAppOffline||this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoUpdated")}`})}))},async openModal(t){const e=this.$tr("ifly.cms.form.updateWorkOrder")+(t.id?` Id: ${t.id}`:"");await(0,o.c)().setIsPassenger(!this.isRamp),await this.$refs.formOrders.loadform({modalProps:{title:e,update:!0,workOrderId:t.id,width:"90vw"},data:t}),(0,o.c)().setTitleOffline(e)},showWorkOrder(t){this.isAppOffline?this.openModal(t):this.$crud.show("apiRoutes.qramp.workOrders",t.id,{refresh:!0,params:{include:"customer,workOrderStatus,operationType,station,contract,responsible"}}).then((async t=>{this.openModal(t.data)})).catch((t=>{console.log(t)}))},async getFlightMap(t){try{(0,o.c)().setWorkOrder(t),(0,o.c)().showVisibleMapModal()}catch(e){(0,o.c)().setWorkOrder(null),console.log(e)}}},provide(){return{showWorkOrder:this.showWorkOrder}}};var f=a(68716);const h=(0,f.c)(p,[["render",s]]),b=h}}]);