"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[4532],{4532:(e,t,a)=>{a.r(t),a.d(t,{default:()=>V});var l=a(92444);function r(e,t,a,r,n,o){const i=(0,l.E1)("q-btn"),s=(0,l.E1)("uploadContractRulesModal");return(0,l.Wz)(),(0,l.An)("div",null,[(0,l.K2)(i,{color:"primary",label:"Upload contract rules",icon:"fa-light fa-cloud-arrow-up",class:"tw-my-4",onClick:t[0]||(t[0]=e=>o.visibleModal(!0))}),(0,l.K2)(s)])}var n=a(36852),o=a(30152),i=a(75836),s=(0,i.cB)({excelList:[],showModal:!1,loadingModal:!1,tableData:[]}),c=(0,l.S6)((function(){return{get excelList(){return s.excelList},set excelList(e){s.excelList=e},get showModal(){return s.showModal},set showModal(e){s.showModal=e},get loadingModal(){return s.loadingModal},set loadingModal(e){s.loadingModal=e},get tableData(){return s.tableData},set tableData(e){s.tableData=e},reset:function(){s.tableData=[],s.excelList=[],s.showModal=!1,s.loadingModal=!1}}})).value;const u=c;var p={class:"tw-flex tw-justify-center"},d={class:"tw-space-y-3 tw-text-center"};function f(e,t,a,r,n,o){var i=(0,l.E1)("q-uploader"),s=(0,l.E1)("q-btn"),c=(0,l.E1)("uploadedRecordsTable"),u=(0,l.E1)("master-modal");return(0,l.Wz)(),(0,l.Az)(u,{modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),title:"Upload Contract Rules","custom-position":"",persistent:!0,loading:e.loadingModal,onHide:e.hide,modalWidthSize:"90vw",maximized:e.$q.screen.lt.md},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",p,[(0,l.QD)("div",d,[(0,l.K2)(i,{label:"Select an Excel file",accept:".xls, .xlsx, .xlsm",onAdded:e.handleFileAdded,"hide-upload-btn":"",onRemoved:e.removeFile,ref:"uploaderFile"},null,8,["onAdded","onRemoved"]),e.isFile?((0,l.Wz)(),(0,l.Az)(s,{key:0,color:"primary",label:"Upload",icon:"fa-light fa-cloud-arrow-up",class:"tw-my-4",onClick:e.saveContractRules},null,8,["onClick"])):(0,l.g1)("",!0)])]),(0,l.QD)("div",null,[(0,l.K2)(c)])]})),_:1},8,["modelValue","loading","onHide","maximized"])}var m=a(31784),y=a(7460),b=a.n(y),v=a(20584),h=a(8932),g=function(e,t,a,l){function r(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,n){function o(e){try{s(l.next(e))}catch(t){n(t)}}function i(e){try{s(l["throw"](e))}catch(t){n(t)}}function s(e){e.done?a(e.value):r(e.value).then(o,i)}s((l=l.apply(e,t||[])).next())}))},w=function(e,t){var a,l,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(e){return function(t){return s([e,t])}}function s(i){if(a)throw new TypeError("Generator is already executing.");while(n&&(n=0,i[0]&&(o=0)),o)try{if(a=1,l&&(r=2&i[0]?l["return"]:i[0]?l["throw"]||((r=l["return"])&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],l=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},L=function(e,t,a){if(a||2===arguments.length)for(var l,r=0,n=t.length;r<n;r++)!l&&r in t||(l||(l=Array.prototype.slice.call(t,0,r)),l[r]=t[r]);return e.concat(l||Array.prototype.slice.call(t))};function C(e){void 0===e&&(e=null);var t=(0,l._S)().proxy,a=(0,i.IL)(null),r=(0,i.IL)(!1),n=(0,i.IL)(),o=(0,l.S6)({get:function(){return u.showModal},set:function(e){u.showModal=e}}),s=(0,l.S6)({get:function(){return u.loadingModal},set:function(e){u.loadingModal=e}}),c=(0,l.S6)((function(){return u.excelList}));function p(e){r.value=!0,n.value=new FileReader,n.value.onload=function(e){var t=new Uint8Array(e.target.result);d(t)},n.value.readAsArrayBuffer(e[0])}function d(e){var t=m.gH(e,{type:"array"}),a=t.Sheets[t.SheetNames[1]],l=m.c$.sheet_to_json(a);u.excelList=l}function f(){var e;return g(this,void 0,void 0,(function(){var t;return w(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),s.value=!0,[4,C()];case 1:return l.sent(),null===(e=a.value)||void 0===e||e.reset(),u.excelList=[],s.value=!1,r.value=!1,h.Qb.success("I completed the upload of the records successfully"),[3,3];case 2:return t=l.sent(),console.log(t),s.value=!1,r.value=!1,[3,3];case 3:return[2]}}))}))}function y(e){return g(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,v.c.put("apiRoutes.qramp.passengerContractRulesUpsert",{attributes:e})];case 1:return t.sent(),[2]}}))}))}function C(){return g(this,void 0,void 0,(function(){var e,t,a,l,r,n,o,i;return w(this,(function(s){switch(s.label){case 0:e=["Contract","Contract Line Workday ID","Contract Line Name","Contract Line Description","SI","Invoice Line Memo","Rate"],t=0,a=u.excelList,s.label=1;case 1:if(!(t<a.length))return[3,11];if(l=a[t],r=l,n=Object.keys(r),!(r.Rate>0)||b().isEqual(n,e))return[3,8];if(o=L(L([],e,!0),["Operation Types"],!1),b().isEqual(n,o))return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,y(l)];case 3:return s.sent(),r.message={text:"OK SUCCESS",color:"green"},[3,5];case 4:return i=s.sent(),console.error("Error updating passenger contract rules:",i),r.message={text:i.message,color:"red"},[3,5];case 5:return[3,7];case 6:r.message={text:"Ignored by operation Type",color:"orange"},s.label=7;case 7:return[3,9];case 8:0===r.Rate&&(r.message={text:"Ignored by rate 0",color:"orange"}),b().isEqual(n,e)&&(r.message={text:"The rule is ignored because you have empty data",color:"orange"}),s.label=9;case 9:u.tableData.push(r),s.label=10;case 10:return t++,[3,1];case 11:return[2]}}))}))}function M(){u.tableData=[],u.excelList=[],n.value=null,r.value=!1}function R(){u.reset(),t.$root.$emit("crud.data.refresh")}return(0,l._O)((function(){u.reset(),r.value=!1})),{showModal:o,loadingModal:s,hide:R,handleFileAdded:p,saveContractRules:f,excelList:c,removeFile:M,uploaderFile:a,isFile:r,uploadContractRulesStore:u}}var M=a(74044),R={class:"q-pa-md"};function T(e,t,a,r,n,o){var i=(0,l.E1)("q-td"),s=(0,l.E1)("q-badge"),c=(0,l.E1)("q-tr"),u=(0,l.E1)("q-table");return(0,l.Wz)(),(0,l.An)("div",R,[(0,l.K2)(u,{title:"Contract rules upload status",rows:e.tableData,columns:e.columns,"row-key":"name",class:"stick-table","rows-per-page-options":[0]},{body:(0,l.Ql)((function(e){return[(0,l.K2)(c,{props:e},{default:(0,l.Ql)((function(){return[(0,l.K2)(i,{key:"Contract Line Workday ID",props:e},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,M.WA)(e.row["Contract Line Workday ID"]),1)]})),_:2},1032,["props"]),(0,l.K2)(i,{key:"Invoice Line Memo",props:e},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,M.WA)(e.row["Invoice Line Memo"]),1)]})),_:2},1032,["props"]),(0,l.K2)(i,{key:"Message",props:e},{default:(0,l.Ql)((function(){return[(0,l.K2)(s,{color:e.row.message.color},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,M.WA)(e.row.message.text),1)]})),_:2},1032,["color"])]})),_:2},1032,["props"])]})),_:2},1032,["props"])]})),_:1},8,["rows","columns"])])}function x(e){void 0===e&&(e=null);var t=(0,l.S6)((function(){return u.excelList})),a=(0,l.S6)((function(){return u.tableData})),r=[{name:"Contract Line Workday ID",label:"Contract Line Workday ID",align:"left",field:"Contract Line Workday ID"},{name:"Invoice Line Memo",label:"Invoice Line Memo",align:"left",field:"Invoice Line Memo"},{name:"Message",label:"Message",align:"left",field:"message"}];return{excelList:t,columns:r,tableData:a}}var q=function(){return q=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var r in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},q.apply(this,arguments)};const I=(0,l._M)({setup:function(){return q({},x())}});var k=a(68716),A=a(94152),D=a(45144),E=a(50213),O=a(29104),Q=a(95252),S=a.n(Q);const W=(0,k.c)(I,[["render",T]]),F=W;S()(I,"components",{QTable:A.c,QTr:D.c,QTd:E.c,QBadge:O.c});var _=function(){return _=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var r in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},_.apply(this,arguments)};const $=(0,l._M)({components:{uploadedRecordsTable:F},setup:function(){return _({},C())}});var N=a(59600),K=a(99140);const B=(0,k.c)($,[["render",f]]),j=B;S()($,"components",{QUploader:N.c,QBtn:K.c});const z={components:{uploadContractRulesModal:j},data(){return{crudId:this.$uid()}},beforeCreated(){this.$nextTick((async()=>{await(0,o.c)().setIsPassenger(!1),await Promise.all([(0,n["default"])().getACTypes(),(0,n["default"])().getOperationType()])}))},computed:{crudData(){return{crudId:this.crudId,apiRoute:"apiRoutes.qramp.passengerContractRules",permission:"ramp.passenger-contract-rules",create:{title:"Create passenger contract rules"},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"width: 50px",action:e=>!1},{name:"contractId",label:"Contract",field:"contract",format:e=>e?e.contractName:"-",popupEdit:!0},{name:"contractLineWId",label:"Contract Line WID",field:"contractLine",format:e=>e?e.contractLineWorkdayId:"-",popupEdit:!0},{name:"invoiceLineMemo",label:"Invoice Line Memo",field:"contractLine",format:e=>e?e.invoiceLineMemo:"-",popupEdit:!0},{name:"products",label:"Product",field:"product",format:e=>e?e.name:"-",popupEdit:!0},{name:"aircraftTypes",label:"Aircraft Types",field:"aircraftTypes",format:e=>e||"-",formatAsync:async e=>{const t=await(0,n["default"])().getACTypesList().filter((t=>{const a=Array.isArray(e.aircraftTypes)?e.aircraftTypes:[];return a.includes(t.id)})).map((e=>e.fullName)).join(", ");return`${t||"-"}`}},{name:"operationTypes",label:"Operation types",field:"operationTypes",format:e=>e||"-",formatAsync:async e=>{const t=await(0,n["default"])().getOperationTypeList().filter((t=>{const a=Array.isArray(e.operationTypes)?e.operationTypes:[];a.includes(t.id)})).map((e=>e.fullName)).join(", ");return`${t||"-"}`}},{name:"delay",label:"Delay",field:"delay",format:e=>"boolean"===typeof e?e?"Yes":"No":"-"},{name:"cancellationType",label:"Cancellation type",field:"cancellationType",format:e=>e||"-"},{name:"valueRule",label:"Value rule",field:"valueRule",format:e=>e||"-"},{name:"valueFrom",label:"Value from",field:"valueFrom",format:e=>e||"-"},{name:"valueTo",label:"Value to",field:"valueTo",format:e=>e||"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],filters:{contractId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qsetupagione.contracts",select:{label:"contractName",id:"id"}},props:{label:"Contract",clearable:!0}},productId:{value:null,type:"select",quickFilter:!0,loadOptions:{apiRoute:"apiRoutes.qramp.products",select:{label:"fullName",id:"id"}},props:{label:"Sales Item",clearable:!0}}},actions:[],requestParams:{include:"contract,contractLine,product"}},update:{title:"Update passenger contract rules"},delete:!0,formLeft:{contractId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qramp.setupContracts",select:{label:"contractName",id:"id"},filterByQuery:!0},props:{label:"Contract",clearable:!0,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},contractLineId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qsetupagione.contractLines",select:{label:"contractLineName",id:"id"},filterByQuery:!0},props:{label:"Contract Line",clearable:!0,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},productId:{value:null,type:"select",loadOptions:{apiRoute:"apiRoutes.qramp.products",select:{label:"name",id:"id"},filterByQuery:!0},props:{label:"Product",clearable:!0,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},aircraftTypes:{value:[],type:"select",props:{label:"Aircraft Types",multiple:!0,useChips:!0,clearable:!0,color:"primary","hide-bottom-space":!1},loadOptions:{apiRoute:"apiRoutes.qfly.aircraftTypes",select:{label:"fullNameWithType",id:"id"}}},operationTypes:{value:[],type:"select",props:{label:"Operation Types",multiple:!0,useChips:!0,clearable:!0,color:"primary"},loadOptions:{apiRoute:"apiRoutes.qramp.operationTypes",select:{label:"operationName",id:"id"}}},delay:{value:null,type:"select",props:{label:"Delay",options:[{label:"Yes",value:!0},{label:"No",value:!1}]}},cancellationType:{value:null,type:"select",props:{label:"Cancellation type",clearable:!0,color:"primary",options:[{label:"Cancelled Flight",value:"cancelledFlight"},{label:"Cancelled Flight W/Services",value:"cancelledFlightWServices"}]}},valueRule:{value:null,type:"select",props:{label:"Value rule",clearable:!0,color:"primary",options:[{label:"Greater Than",value:"Greater Than"},{label:"Greater than or equal",value:"Greater than or equal"},{label:"Less than",value:"Less than"},{label:"Less than or equal",value:"Less than or equal"},{label:"Between",value:"Between"},{label:"Equal",value:"Equal"}]}},valueFrom:{value:null,type:"input",props:{label:"Value from"}},valueTo:{value:null,type:"input",props:{label:"Value to"}}},formRight:{}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}}},methods:{visibleModal(e=!1){u.showModal=e}}},U=(0,k.c)(z,[["render",r]]),V=U;S()(z,"components",{QBtn:K.c})}}]);